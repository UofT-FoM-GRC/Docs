
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../version_control/branches/">
      
      
      <link rel="icon" href="../assets/images/UofT_CoA.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Data Analysis Pipeline - FoM GRC Data Analysis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-survey-analysis-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FoM GRC Data Analysis Documentation" class="md-header__button md-logo" aria-label="FoM GRC Data Analysis Documentation" data-md-component="logo">
      
  <img src="../assets/images/UofT_CoA.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FoM GRC Data Analysis Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Analysis Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FoM GRC Data Analysis Documentation" class="md-nav__button md-logo" aria-label="FoM GRC Data Analysis Documentation" data-md-component="logo">
      
  <img src="../assets/images/UofT_CoA.svg" alt="logo">

    </a>
    FoM GRC Data Analysis Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Data Analysis Pipeline
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Data Analysis Pipeline
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-the-google-forms-api" class="md-nav__link">
    <span class="md-ellipsis">
      Calling the Google Forms API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-the-rename-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the Rename Configuration File
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuilding-the-data-tidying-config" class="md-nav__link">
    <span class="md-ellipsis">
      Rebuilding the Data Tidying Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-the-data-tidying-config" class="md-nav__link">
    <span class="md-ellipsis">
      Applying the Data Tidying Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doing-your-specific-analyses" class="md-nav__link">
    <span class="md-ellipsis">
      Doing Your Specific Analyses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Version Control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Version Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../version_control/branches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Branches
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../version_control/committing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Committing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../version_control/merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-the-google-forms-api" class="md-nav__link">
    <span class="md-ellipsis">
      Calling the Google Forms API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-the-rename-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the Rename Configuration File
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuilding-the-data-tidying-config" class="md-nav__link">
    <span class="md-ellipsis">
      Rebuilding the Data Tidying Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-the-data-tidying-config" class="md-nav__link">
    <span class="md-ellipsis">
      Applying the Data Tidying Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doing-your-specific-analyses" class="md-nav__link">
    <span class="md-ellipsis">
      Doing Your Specific Analyses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="data-survey-analysis-pipeline">Data Survey Analysis Pipeline</h1>
<h2 id="introduction">Introduction</h2>
<p>Fundamentally, the data survey analysis pipeline is split into the following phases:</p>
<p>1) Calling the Google Forms API to retrieve the metadata for a particular year's form</p>
<p>2) Updating the rename (i.e. "common name") configuration file</p>
<p>3) Rebuilding the data tidying config</p>
<p>4) Applying the data tidying config to all the survey data files to generate a single longitudinal dataframe</p>
<p>5) Doing your specific analyses</p>
<h2 id="calling-the-google-forms-api">Calling the Google Forms API</h2>
<p>The Google Forms API is called using the <code>google-forms-api</code> package. The metadata that is retrieved looks akin the following example for a particular field:</p>
<pre><code class="language-json">        {
            &quot;itemId&quot;: &quot;3c5cb287&quot;,
            &quot;title&quot;: &quot;If you did not (or will not) transfer into a PhD, what specifically impacted your decision?&quot;,
            &quot;questionItem&quot;: {
                &quot;question&quot;: {
                    &quot;questionId&quot;: &quot;6cbc03ed&quot;,
                    &quot;choiceQuestion&quot;: {
                        &quot;type&quot;: &quot;CHECKBOX&quot;,
                        &quot;options&quot;: [
                            {
                                &quot;value&quot;: &quot;Have dependents to take care of&quot;
                            },
                            {
                                &quot;value&quot;: &quot;Can't afford to live in Toronto&quot;
                            },
                            {
                                &quot;value&quot;: &quot;Proceeding to professional school&quot;
                            },
                            {
                                &quot;value&quot;: &quot;Long duration of PhD program in combination with the current level of funding&quot;
                            },
                            {
                                &quot;isOther&quot;: true
                            }
                        ]
                    }
                }
            }
        },
</code></pre>
<p>These are saved in the <code>data/google</code> directory as <code>Form_Metadata_YYYY_YY.json</code> where <code>YYYY_YY</code> is the academic years that the form was active for.</p>
<h2 id="updating-the-rename-configuration-file">Updating the Rename Configuration File</h2>
<p>The next step is to make sense of which fields are common between the years. This is accomplished using a rename configuration file located at <code>/config/GRC_Rename_Config.yaml</code>. Here is what a typical entry looks like:</p>
<pre><code class="language-yaml">  - name: scholarshipsMotive
    history:
      2017: null
      2018: null
      2019: What is your motivation to apply for scholarships/awards? (select all that apply)
      2020: What is your motivation to apply for scholarships/awards?
      2021: What is your motivation to apply for scholarships/awards?
      2022: What is your motivation to apply for scholarships/awards?
      2023: What is your motivation to apply for scholarships/awards?
</code></pre>
<p>The <code>name</code> field is the common name that will be used in the final longitudinal dataframe. The <code>history</code> field is a dictionary where the keys are the years and the values are the corresponding field names in the Google Form metadata. If the field was not present in a particular year, the value is <code>null</code>.</p>
<p>There will be specific service functions prepared in <code>/src/services/update_rename.py</code> that will auto-update the rename config file with the newest year pre-populated with a <code>null</code> value.</p>
<p><strong>THIS SHOULD BE UPDATED IN REAL-TIME AS NEW SURVERYS ARE BEING DEVELOPED BY THE TEAM. ASSIGN A PARTICULAR PERSON TO BE RESPONSIBLE FOR THIS TASK.</strong></p>
<h2 id="rebuilding-the-data-tidying-config">Rebuilding the Data Tidying Config</h2>
<p>Using the metadata from the Google Forms API and the rename configuration file, the data tidying config can be rebuilt. Like the rename configuration file, this is located at <code>/config/GRC_Tidy_Config.yaml</code> . Here is what a typical entry looks like:</p>
<p>TODO</p>
<p>There are multiple operations that can be specified on the data. These are applied in the order that they are specified in the config file. The operations are:</p>
<ul>
<li><code>PASSTHROUGH</code>: This operation does nothing. It is used to pass the data through to the next operation.</li>
<li><code>RENAME</code>: This operation renames the column to the common name specified in the rename configuration file.</li>
<li><code>REPLACE</code>: This operation replaces the values in the column with the specified values.</li>
<li><code>SPLIT_TO_WIDE</code>: This operation splits the column into multiple columns based on the specified delimiter. This is particularly used for checkbox fields, as the separator that Google uses is <code>", "</code>.</li>
<li><code>REGEX_EXTRACT_AND_REPLACE</code>: This operation extracts a series of text values from text fields using a regular expression and replaces the original text field with the extracted values. This is useful for syncing up data that used to be in text fields but are now in radio/dropdown fields.</li>
<li><code>ONE_HOT_ENCODE</code>: This operation one-hot encodes the column. This is useful for syncing up radio/dropdown fields that have changed over the years to become checkbox fields.</li>
<li><code>RENAME_ROWS</code>: This is a unique operation to grid-based fields. It renames the rows to the specified values. Note that this specifically targets the row names as they appear in the raw excel output, typically in the format <code>Main_Quesiton [Row_Name]</code>. The <code>Main_Question</code> part is unaffected and should be handled by the <code>RENAME</code> operation. To avoid bugs <strong>it is recommended to run this first and prior to the RENAME operation</strong></li>
</ul>
<p>There will be specific service functions in <code>/src/services/build_tidy.py</code> prepared that will auto-update the tidy config file with the "best guess" series of operations that should be applied to the data for a particular year.</p>
<p><strong>IT SHOULD BE THE COLLECTIVE RESPONSIBILITY OF THE DATA ANALYSTS TO ENSURE THAT THE "BEST GUESS" OPERATIONS ARE APPROPRIATE TO THE DATA ANALYSIS AND TO ADJUST THE CONFIG AS NECESSARY MANUALLY. MANUAL CHANGES ALWAYS SUPERIMPOSE AUTOMATIC ONES.</strong></p>
<h2 id="applying-the-data-tidying-config">Applying the Data Tidying Config</h2>
<p>Once the data tidying config is set up, the data can be tidied using the <code>src/services/apply_tidy</code> service functions. The output will be a single longitudinal dataframe that can be used for analysis located in the <code>/data/cleaned/survey</code> directory.</p>
<h2 id="doing-your-specific-analyses">Doing Your Specific Analyses</h2>
<p>This will be up to you, dear data analyst. Godspeed.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>